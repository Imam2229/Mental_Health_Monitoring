<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Journal â€” MindWell</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- Icons -->
  <script src="https://kit.fontawesome.com/a2e0b6f4e4.js" crossorigin="anonymous"></script>
</head>

<body class="fade-in">
  <!-- ================= HEADER ================= -->
  <header class="site-header">
    <div class="container header-inner">
      <a href="{{ url_for('dashboard') }}" class="brand">
        ğŸŒ± <span>MindWell</span>
      </a>
      <nav class="nav">
        <a href="{{ url_for('index') }}" class="{% if request.endpoint == 'index' %}active{% endif %}">Home</a>
        <a href="{{ url_for('dashboard') }}" class="{% if request.endpoint == 'dashboard' %}active{% endif %}">Dashboard</a>
        <a href="{{ url_for('journal') }}" class="{% if request.endpoint == 'journal' %}active{% endif %}">Journal</a>
        <a href="{{ url_for('meditation') }}" class="{% if request.endpoint == 'meditation' %}active{% endif %}">Meditation</a>
        <a href="{{ url_for('community') }}" class="{% if request.endpoint == 'community' %}active{% endif %}">Community</a>
        <a href="{{ url_for('export') }}" class="{% if request.endpoint == 'export' %}active{% endif %}">Export</a>
      </nav>
    </div>
  </header>

  <!-- ================= JOURNAL SECTION ================= -->
  <main class="journal container fade-in">
    <!-- Intro Header -->
    <section class="journal-header text-center fade-up delay-1">
      <h1 class="page-title">ğŸª¶ Your Daily Journal</h1>
      <p class="subtitle">Write. Reflect. Heal. Every entry is a step toward self-awareness ğŸŒ¿</p>
    </section>

    <!-- Journal Form -->
    <section class="journal-form-section fade-up delay-2">
      <div class="journal-card glass">
        <h2 class="form-title">New Entry</h2>
        <form id="journalForm" class="auth-form">
          <textarea
            id="journalEntry"
            name="journalEntry"
            class="journal-textarea"
            placeholder="Whatâ€™s on your mind today? Write freely..."
            rows="7"
            required
          ></textarea>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary glow">
              <i class="fas fa-save"></i> Save Entry
            </button>
            <button type="button" id="clearEntry" class="btn btn-outline">
              <i class="fas fa-broom"></i> Clear
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- Recent Entries -->
    <section class="journal-entries-section fade-up delay-3">
      <div class="entries-header">
        <h2>Recent Entries</h2>
        <span class="entries-count"><strong id="entriesCount">0</strong> entries saved</span>
      </div>

      <ul id="entriesList" class="entries-list fade-in"></ul>

      <!-- Empty State -->
      <div id="emptyState" class="empty-state fade-in">
        <div class="empty-icon">ğŸ§˜â€â™€ï¸</div>
        <h3>No Journal Entries Yet</h3>
        <p>Start writing your first reflection â€” this is your safe space to express yourself.</p>
      </div>
    </section>
  </main>

  <!-- ================= FOOTER ================= -->
  <footer class="site-footer fade-up delay-4">
    <div class="container">
      <p>Â© 2025 <strong>MindWell</strong> â€” Empowering emotional wellness and reflection ğŸŒ¿</p>
    </div>
  </footer>

  <!-- JS -->
  <script>
    // ==============================
    // Journal Page Logic (LocalStorage)
    // ==============================

    const journalForm = document.getElementById("journalForm");
    const journalEntry = document.getElementById("journalEntry");
    const entriesList = document.getElementById("entriesList");
    const emptyState = document.getElementById("emptyState");
    const entriesCount = document.getElementById("entriesCount");

    let entries = JSON.parse(localStorage.getItem("mindwell_journal")) || [];

    // Update UI
    function updateEntriesUI() {
      entriesList.innerHTML = "";
      entriesCount.textContent = entries.length;
      emptyState.style.display = entries.length === 0 ? "block" : "none";

      entries.forEach((entry, index) => {
        const li = document.createElement("li");
        li.className = "fade-in";
        li.innerHTML = `
          <div class="entry-content" contenteditable="false">${entry.text}</div>
          <div class="entry-meta">
            <span>${new Date(entry.date).toLocaleString()}</span>
            <div class="entry-actions">
              <button class="edit-btn" title="Edit"><i class="fas fa-edit"></i></button>
              <button class="delete-btn" title="Delete"><i class="fas fa-trash-alt"></i></button>
            </div>
          </div>
        `;

        // Edit
        li.querySelector(".edit-btn").addEventListener("click", () => {
          const contentDiv = li.querySelector(".entry-content");
          const isEditable = contentDiv.getAttribute("contenteditable") === "true";

          if (!isEditable) {
            contentDiv.setAttribute("contenteditable", "true");
            contentDiv.focus();
            li.querySelector(".edit-btn i").classList.replace("fa-edit", "fa-check");
          } else {
            entries[index].text = contentDiv.textContent.trim();
            contentDiv.setAttribute("contenteditable", "false");
            li.querySelector(".edit-btn i").classList.replace("fa-check", "fa-edit");
            localStorage.setItem("mindwell_journal", JSON.stringify(entries));
          }
        });

        // Delete
        li.querySelector(".delete-btn").addEventListener("click", () => {
          li.style.opacity = "0";
          li.style.transform = "translateY(10px)";
          setTimeout(() => {
            entries.splice(index, 1);
            localStorage.setItem("mindwell_journal", JSON.stringify(entries));
            updateEntriesUI();
          }, 300);
        });

        entriesList.appendChild(li);
      });
    }

    // Add new entry
    journalForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = journalEntry.value.trim();
      if (!text) return;
      const newEntry = { text, date: new Date().toISOString() };
      entries.unshift(newEntry);
      localStorage.setItem("mindwell_journal", JSON.stringify(entries));
      journalEntry.value = "";
      updateEntriesUI();
    });

    // Clear form
    document.getElementById("clearEntry").addEventListener("click", () => {
      journalEntry.value = "";
    });

    // Initial render
    updateEntriesUI();
  </script>
</body>
</html>
